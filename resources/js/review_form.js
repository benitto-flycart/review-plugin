/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/review-form.ts":
/*!****************************!*\
  !*** ./src/review-form.ts ***!
  \****************************/
/***/ (function(__unused_webpack_module, exports) {

eval("\n// src/app.ts\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\njQuery(document).ready(function ($) {\n    (function WIDGET_REVIEW_FORM_DEFAULT() {\n        var _this = this;\n        //@ts-ignore\n        var review_form_store_config = window.review_form_store_config;\n        var template = document.getElementById('r_rfw_shadow_template');\n        // Step 2: Get the host element where the Shadow DOM will be attached\n        var host = document.getElementById('r_rfw_dialog_wrapper');\n        var shadowRoot = host.attachShadow({ mode: 'open' });\n        shadowRoot.appendChild(template.content.cloneNode(true));\n        template.remove();\n        var review_details = {\n            order_id: 0,\n            product_id: 0,\n            rating: 0,\n            review_text: '',\n            first_name: '',\n            last_name: '',\n            email: '',\n            translateX: 0,\n            activeSlide: {\n                index: 0,\n                name: ''\n            },\n            files: {\n                photos: [],\n            }\n        };\n        var REVIEW_FORM = {\n            submitSlide: '',\n            lastSlide: '',\n            initActiveSlide: function () {\n                review_details.activeSlide.index = 0;\n                review_details.activeSlide.name = REVIEW_FORM.getSlideNameToSet();\n            },\n            sliding: false,\n            slideInLock: function () {\n                return REVIEW_FORM.sliding;\n            },\n            lockSlide: function () {\n                REVIEW_FORM.sliding = true;\n            },\n            enableSlide: function () {\n                setTimeout(function () {\n                    REVIEW_FORM.sliding = false;\n                }, 1000);\n            },\n            validate: function () {\n                var slideName = REVIEW_FORM.getActiveSlideName();\n                console.log('printing slide name inside validate');\n                console.log(slideName);\n                if (slideName == 'review') {\n                    return REVIEW_FORM.validateReviewContent();\n                }\n                else if (slideName == 'reviewer') {\n                    return REVIEW_FORM.validateReviewerInfo();\n                }\n                return true;\n            },\n            validateReviewContent: function () {\n                var isValid = review_details.review_text.trim() != '';\n                var reviewTextError = shadowRoot.querySelector('.r_rfw_review_text_error');\n                if (!isValid && reviewTextError) {\n                    $(reviewTextError).html('Review Text Required');\n                    $(reviewTextError).removeClass('r_rfw_hide');\n                }\n                else {\n                    $(reviewTextError).addClass('r_rfw_hide');\n                }\n                return isValid;\n            },\n            validateReviewerInfo: function () {\n                function hideReviewerInfoErrors() {\n                    var _a;\n                    (_a = shadowRoot.querySelectorAll('.r_rfw_review_info_error')) === null || _a === void 0 ? void 0 : _a.forEach(function (item, index) {\n                        $(item).addClass('r_rfw_hide').html('');\n                    });\n                }\n                ;\n                function validateEmail(email) {\n                    // Regular expression for email validation\n                    var re = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,6}$/;\n                    return re.test(email);\n                }\n                hideReviewerInfoErrors();\n                var firstNameValid = review_details.first_name.trim() != '';\n                var lastNameValid = review_details.last_name.trim() != '';\n                var emailValid = review_details.email.trim() != '';\n                var validEmailFormat = validateEmail(review_details.email.trim());\n                var isValid = firstNameValid && lastNameValid && emailValid && validEmailFormat;\n                if (!isValid) {\n                    var firstnameDom = shadowRoot.querySelector('.r_rfw_review_info_first_name_error');\n                    var lastnameDom = shadowRoot.querySelector('.r_rfw_review_info_last_name_error');\n                    var emailDom = shadowRoot.querySelector('.r_rfw_review_info_email_error');\n                    if (!firstNameValid) {\n                        $(firstnameDom).html('first name is required').removeClass('r_rfw_hide');\n                    }\n                    if (!lastNameValid) {\n                        $(lastnameDom).html('Last name is required').removeClass('r_rfw_hide');\n                    }\n                    if (!emailValid) {\n                        $(emailDom).html('Email is required').removeClass('r_rfw_hide');\n                    }\n                    else if (!validEmailFormat) {\n                        $(emailDom).html('Invalid Email format').removeClass('r_rfw_hide');\n                    }\n                }\n                else {\n                    hideReviewerInfoErrors();\n                }\n                return isValid;\n            },\n            getActiveSlideName: function () {\n                return review_details.activeSlide.name;\n            },\n            getSlideNameToSet: function () {\n                var _a;\n                var slides = __assign({}, REVIEW_FORM.slides);\n                var index = (_a = review_details === null || review_details === void 0 ? void 0 : review_details.activeSlide) === null || _a === void 0 ? void 0 : _a.index;\n                if (index == undefined)\n                    return review_details.activeSlide.name;\n                var slide = slides[index];\n                return slide.name;\n            },\n            getActiveSlideIndex: function () {\n                return review_details.activeSlide.index;\n            },\n            getNextButtonName: function () {\n                if (REVIEW_FORM.getActiveSlideName() == 'photo') {\n                    return REVIEW_FORM.submitSlide == 'photo' ? 'DONE' : review_details.files.photos.length > 0 ? 'CONTINUE' : 'SKIP';\n                    // return images.length == 0 ? 'Skip' : 'Continue';\n                }\n                else if (REVIEW_FORM.getActiveSlideName() == 'review') {\n                    return REVIEW_FORM.submitSlide == 'review' ? 'DONE' : 'Continue';\n                }\n                else if (REVIEW_FORM.getActiveSlideName() == 'reviewer') {\n                    return REVIEW_FORM.submitSlide == 'reviewer' ? 'DONE' : 'Done';\n                }\n                else {\n                    return 'Continue';\n                }\n            },\n            isNeedToShowNext: function () {\n                if (REVIEW_FORM.getActiveSlideName() == 'rating' || REVIEW_FORM.getActiveSlideName() == 'thank_you' || review_details.activeSlide.name == 'next_products') {\n                    return false;\n                }\n                return true;\n            },\n            slide: function () {\n                var mainContentWrapper = shadowRoot === null || shadowRoot === void 0 ? void 0 : shadowRoot.querySelector('.r_rfw_main_content_wrapper');\n                mainContentWrapper.style.transform = \"translateX(\".concat(review_details.translateX, \"%)\");\n                var activeSlideName = REVIEW_FORM.getActiveSlideName();\n                if (activeSlideName != 'rating' && activeSlideName != REVIEW_FORM.lastSlide) {\n                    REVIEW_FORM.showFooter();\n                }\n                else {\n                    REVIEW_FORM.hideFooter();\n                }\n            },\n            slideNext: function () { return __awaiter(_this, void 0, void 0, function () {\n                var submitResult;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            //if Previous action is incomplete early returning\n                            if (REVIEW_FORM.slideInLock())\n                                return [2 /*return*/];\n                            REVIEW_FORM.lockSlide();\n                            if (!REVIEW_FORM.validate()) {\n                                REVIEW_FORM.enableSlide();\n                                return [2 /*return*/];\n                            }\n                            if (!(REVIEW_FORM.getActiveSlideName() == REVIEW_FORM.submitSlide)) return [3 /*break*/, 2];\n                            return [4 /*yield*/, REVIEW_FORM.submit()];\n                        case 1:\n                            submitResult = _a.sent();\n                            console.log(submitResult);\n                            if (!submitResult) {\n                                alert('api error occurred');\n                                REVIEW_FORM.enableSlide();\n                                return [2 /*return*/];\n                            }\n                            _a.label = 2;\n                        case 2:\n                            if (review_details.activeSlide.index == REVIEW_FORM.slides.length - 1) {\n                                REVIEW_FORM.enableSlide();\n                                return [2 /*return*/];\n                            }\n                            //Updating Sliding Index and Sliding name\n                            review_details.activeSlide.index += 1;\n                            review_details.activeSlide.name = REVIEW_FORM.getSlideNameToSet();\n                            review_details.translateX -= 100;\n                            REVIEW_FORM.slide();\n                            REVIEW_FORM.enableSlide();\n                            return [2 /*return*/];\n                    }\n                });\n            }); },\n            slidePrev: function () {\n                if (review_details.activeSlide.index == 0) {\n                    return;\n                }\n                review_details.activeSlide.index -= 1;\n                review_details.activeSlide.name = REVIEW_FORM.getSlideNameToSet();\n                review_details.translateX += 100;\n                REVIEW_FORM.slide();\n            },\n            hideFooter: function () {\n                var footer = shadowRoot.querySelector('.r_rfw_footer_wrapper');\n                if (footer) {\n                    $(footer).addClass('r_rfw_hide');\n                }\n            },\n            showFooter: function () {\n                var footer = shadowRoot.querySelector('.r_rfw_footer_wrapper');\n                if (footer) {\n                    $(footer).removeClass('r_rfw_hide');\n                    var forwardButton = shadowRoot.querySelector('.r_rfw_footer_forward_btn');\n                    if (REVIEW_FORM.isNeedToShowNext()) {\n                        var nextButtonName = REVIEW_FORM.getNextButtonName();\n                        if (forwardButton) {\n                            $(forwardButton).html(nextButtonName);\n                            $(forwardButton).removeClass('r_rfw_hide');\n                        }\n                    }\n                    else {\n                        if (forwardButton) {\n                            $(forwardButton).addClass('r_rfw_hide');\n                        }\n                    }\n                }\n            },\n            rating: {\n                init: function () {\n                    shadowRoot.querySelectorAll('.r_rfw_rating_icon').forEach(function (item, index) {\n                        item.addEventListener('click', function () {\n                            // @ts-ignore\n                            REVIEW_FORM.rating.ratingAnimation(index + 1);\n                            REVIEW_FORM.slideNext();\n                        });\n                    });\n                },\n                ratingAnimation: function (rating) {\n                    shadowRoot.querySelectorAll('.r_rfw_rating_icon').forEach(function (item, index) {\n                        if (index < rating) {\n                            $(item).addClass('review_rating_active');\n                        }\n                        else {\n                            $(item).removeClass('review_rating_active');\n                        }\n                    });\n                }\n            },\n            photo: {\n                init: function () {\n                    var _a, _b, _c;\n                    (_a = shadowRoot.querySelectorAll('.wd_add_photos_btn')) === null || _a === void 0 ? void 0 : _a.forEach(function (item, index) {\n                        $(item).on('click', function () {\n                            var fileInput = shadowRoot.querySelector('.r_frw_file_input');\n                            if (fileInput) {\n                                $(fileInput).trigger('click');\n                            }\n                        });\n                    });\n                    (_b = shadowRoot.querySelectorAll('.r_frw_img_close_icon')) === null || _b === void 0 ? void 0 : _b.forEach(function (item, index) {\n                        $(item).on('click', function (e) {\n                            alert('clicked');\n                        });\n                    });\n                    (_c = shadowRoot.querySelector('.r_frw_file_input')) === null || _c === void 0 ? void 0 : _c.addEventListener('change', function (e) {\n                        var _a;\n                        var file = (_a = e.target) === null || _a === void 0 ? void 0 : _a.files[0];\n                        var reader = new FileReader();\n                        reader.onloadend = function () {\n                            var formData = new FormData();\n                            // Append your other data\n                            formData.append('method', 'upload_review_image');\n                            formData.append('action', review_form_store_config.action);\n                            formData.append('_wp_nonce', review_form_store_config._wp_nonce);\n                            formData.append('_wp_nonce_key', review_form_store_config._wp_nonce_key);\n                            // Append the file\n                            formData.append('upload_image', file);\n                            $.ajax(review_form_store_config.ajax_url, {\n                                method: 'POST',\n                                contentType: false,\n                                processData: false,\n                                data: formData,\n                            }).then(function (response) {\n                                var _a, _b, _c, _d;\n                                var data = response.data;\n                                if (data === null || data === void 0 ? void 0 : data.attachment_id) {\n                                    review_details.files.photos.push({\n                                        id: data.attachment_id,\n                                        url: data.attachment_url\n                                    });\n                                }\n                                else {\n                                    return;\n                                }\n                                console.log(review_details.files);\n                                var imageContainer = (_a = shadowRoot.querySelector('.r_frw_img_container')) === null || _a === void 0 ? void 0 : _a.cloneNode(true);\n                                //Setting attachment id used when for deleting.\n                                $(imageContainer).attr('image-id', data.attachment_id);\n                                $(imageContainer).attr('image-url', data.attachment_url);\n                                //@ts-ignore\n                                (_b = $(imageContainer)) === null || _b === void 0 ? void 0 : _b.find('img').attr('src', data.attachment_url);\n                                $(imageContainer).removeClass('r_rfw_hide');\n                                var list = shadowRoot.querySelector('.r_frw_photos_list');\n                                (_c = $(list)) === null || _c === void 0 ? void 0 : _c.prepend(imageContainer);\n                                var photoContainer = shadowRoot.querySelector('.r_frw_view_photos_container');\n                                (_d = $(photoContainer)) === null || _d === void 0 ? void 0 : _d.find('.r_frw_img_close_icon').on('click', function () {\n                                    var imgContainer = $(this).parent();\n                                    var image_id = imgContainer.attr('image-id');\n                                    var remaining_photos = review_details.files.photos.filter(function (photo) { return photo.id != image_id; });\n                                    review_details.files.photos = remaining_photos;\n                                    imgContainer.remove();\n                                    showUploadButtons();\n                                });\n                                function showUploadButtons() {\n                                    var _a, _b, _c, _d;\n                                    var addPhotoBtn = shadowRoot.querySelector('.r_rfw_empty_photo_section');\n                                    if (review_details.files.photos.length != 0) {\n                                        (_a = $(addPhotoBtn)) === null || _a === void 0 ? void 0 : _a.addClass('r_rfw_hide');\n                                        (_b = $(photoContainer)) === null || _b === void 0 ? void 0 : _b.removeClass('r_rfw_hide');\n                                    }\n                                    else {\n                                        (_c = $(photoContainer)) === null || _c === void 0 ? void 0 : _c.addClass('r_rfw_hide');\n                                        (_d = $(addPhotoBtn)) === null || _d === void 0 ? void 0 : _d.removeClass('r_rfw_hide');\n                                    }\n                                }\n                                showUploadButtons();\n                                REVIEW_FORM.slideNext();\n                            }).catch(function () {\n                            });\n                        };\n                        reader.readAsDataURL(file);\n                    });\n                }\n            },\n            review_content: {\n                init: function () {\n                    var _a;\n                    (_a = shadowRoot.querySelector('.r_rfw_review_content_text')) === null || _a === void 0 ? void 0 : _a.addEventListener('change', function (event) {\n                        review_details.review_text = event.target.value;\n                    });\n                }\n            },\n            reviewer_info: {\n                init: function () {\n                    var _a, _b, _c;\n                    (_a = shadowRoot.querySelector('.r_rfw_reviewer_first_name')) === null || _a === void 0 ? void 0 : _a.addEventListener('change', function (event) {\n                        review_details.first_name = event.target.value;\n                        console.log('updating first name');\n                    });\n                    (_b = shadowRoot.querySelector('.r_rfw_reviewer_last_name')) === null || _b === void 0 ? void 0 : _b.addEventListener('change', function (event) {\n                        review_details.last_name = event.target.value;\n                        console.log('updating last name');\n                    });\n                    (_c = shadowRoot.querySelector('.r_rfw_reviewer_email')) === null || _c === void 0 ? void 0 : _c.addEventListener('change', function (event) {\n                        review_details.email = event.target.value;\n                    });\n                }\n            },\n            footer: {\n                init: function () {\n                    var _a;\n                    shadowRoot.querySelectorAll('.r_rfw_footer_back_btn').forEach(function (item, index) {\n                        item.addEventListener('click', function () {\n                            REVIEW_FORM.slidePrev();\n                        });\n                    });\n                    shadowRoot.querySelectorAll('.r_rfw_footer_forward_btn, .r_rfw_continue_btn').forEach(function (item, index) {\n                        item.addEventListener('click', function () {\n                            console.log('clicked');\n                            REVIEW_FORM.slideNext();\n                        });\n                    });\n                    (_a = shadowRoot.querySelector('.r_rfw_dialog_close_icon')) === null || _a === void 0 ? void 0 : _a.addEventListener('click', function () {\n                        setTimeout(function () {\n                            window.location.href = 'shop';\n                        }, 500);\n                    });\n                    REVIEW_FORM.hideFooter();\n                }\n            },\n            init: function () {\n                var dialog = shadowRoot.querySelector('#review_form_dialog');\n                console.log(dialog);\n                var order_id = dialog === null || dialog === void 0 ? void 0 : dialog.getAttribute('data-order-id');\n                var product_id = dialog === null || dialog === void 0 ? void 0 : dialog.getAttribute('data-product-id');\n                //@ts-ignore\n                review_details.order_id = order_id ? order_id : 0;\n                //@ts-ignore\n                review_details.product_id = product_id ? product_id : 0;\n                $.ajax(review_form_store_config.ajax_url, {\n                    method: 'POST',\n                    data: {\n                        action: review_form_store_config.action,\n                        method: 'review_form_template',\n                        product_id: product_id,\n                        order_id: order_id,\n                        _wp_nonce: review_form_store_config._wp_nonce,\n                        _wp_nonce_key: review_form_store_config._wp_nonce_key,\n                    },\n                    contentType: 'application/x-www-form-urlencoded',\n                }).then(function (response) {\n                    var response_data = response.data;\n                    REVIEW_FORM.slides = response_data.slides;\n                    REVIEW_FORM.submitSlide = response_data.submit_button_slide;\n                    REVIEW_FORM.lastSlide = response_data.last_slide;\n                    REVIEW_FORM.initActiveSlide();\n                    $(dialog).html(response_data.template);\n                    if (REVIEW_FORM.hasSlide('rating')) {\n                        console.log('rating not called');\n                        REVIEW_FORM.rating.init();\n                    }\n                    if (REVIEW_FORM.hasSlide('photo')) {\n                        console.log('photo called');\n                        REVIEW_FORM.photo.init();\n                    }\n                    if (REVIEW_FORM.hasSlide('review')) {\n                        REVIEW_FORM.review_content.init();\n                    }\n                    if (REVIEW_FORM.hasSlide('reviewer')) {\n                        REVIEW_FORM.reviewer_info.init();\n                    }\n                    REVIEW_FORM.footer.init();\n                    REVIEW_FORM.showFooter();\n                }).catch(function () {\n                    console.log(\"error occurred while loading review template\");\n                });\n            },\n            hasSlide: function (name) {\n                var found = REVIEW_FORM.slides.find(function (item) {\n                    return item.name == name;\n                });\n                return found ? true : false;\n            },\n            submit: function () { return __awaiter(_this, void 0, void 0, function () {\n                var result, error_1;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            _a.trys.push([0, 2, , 3]);\n                            return [4 /*yield*/, $.ajax(review_form_store_config.ajax_url, {\n                                    method: 'POST',\n                                    data: __assign(__assign({ method: 'save_customer_review', action: review_form_store_config.action, product_id: review_details.product_id, order_id: review_details.order_id, review_text: review_details.review_text, rating: review_details.rating }, (!review_details.order_id ? {\n                                        review_text: review_details.review_text,\n                                        last_name: review_details.last_name,\n                                        email: review_details.email,\n                                    } : {})), { photos: review_details.files.photos })\n                                })];\n                        case 1:\n                            result = _a.sent();\n                            return [2 /*return*/, result];\n                        case 2:\n                            error_1 = _a.sent();\n                            console.error(error_1);\n                            return [2 /*return*/, false];\n                        case 3: return [2 /*return*/];\n                    }\n                });\n            }); }\n        };\n        REVIEW_FORM.init();\n    })();\n});\n\n\n//# sourceURL=webpack://scripts/./src/review-form.ts?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/review-form.ts"](0, __webpack_exports__);
/******/ 	
/******/ })()
;